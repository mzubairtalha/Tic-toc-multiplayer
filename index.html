<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chit Chat</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>Chit Chat</header>

<div id="name-container">
  <input type="text" id="nameInput" placeholder="Enter Your Name">
  <button id="saveNameBtn">Save</button>
</div>

<div id="main-interface" style="display: none;">
  <div id="search-container">
    <input type="text" id="searchUserInput" placeholder="Search User">
    <button id="searchUserBtn">Search</button>
  </div>
  <button id="worldChatBtn">World Chat</button>
  <div id="recent-chats">
    <h3>Recent Chats</h3>
    <div id="recentChatsContainer"></div>
  </div>
</div>

<div id="world-chat" style="display: none;">
  <h2>World Chat</h2>
  <div id="chat-box"></div>
  <textarea id="messageInput" placeholder="Type your message"></textarea>
  <button id="sendWorldMessageBtn">Send</button>
  <button id="backToMainBtn">Back</button>
</div>

<div id="private-chat" style="display: none;">
  <h2 id="chatWithTitle"></h2>
  <div id="privateChatBox"></div>
  <textarea id="privateMessageInput" placeholder="Type your message"></textarea>
  <button id="sendPrivateMessageBtn">Send</button>
  <button id="backToMainFromPrivateBtn">Back</button>
</div>
<script>
  (function () {
  var firebaseConfig = {
    apiKey: "AIzaSyCE5gLp99K4IUq6V-BhlmgOcTtTjjG6WpU",
    authDomain: "chat-app-9d3d2.firebaseapp.com",
    databaseURL: "https://chat-app-9d3d2-default-rtdb.firebaseio.com",
    projectId: "chat-app-9d2d2",
    storageBucket: "chat-app-9d2d2.appspot.com",
    messagingSenderId: "110218700281",
    appId: "1:110218700281:web:470b92a7e4b223a0660928",
    measurementId: "G-PZKV7JTD5K",
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();

  // DOM Elements
  var nameContainer = document.getElementById("name-container");
  var mainInterface = document.getElementById("main-interface");
  var worldChatSection = document.getElementById("world-chat");
  var privateChatSection = document.getElementById("private-chat");

  var nameInput = document.getElementById("nameInput");
  var saveNameBtn = document.getElementById("saveNameBtn");
  var searchUserInput = document.getElementById("searchUserInput");
  var searchUserBtn = document.getElementById("searchUserBtn");
  var worldChatBtn = document.getElementById("worldChatBtn");
  var backToMainBtn = document.getElementById("backToMainBtn");

  var recentChatsContainer = document.getElementById("recentChatsContainer");
  var chatBox = document.getElementById("chat-box");
  var messageInput = document.getElementById("messageInput");
  var sendWorldMessageBtn = document.getElementById("sendWorldMessageBtn");

  var chatWithTitle = document.getElementById("chatWithTitle");
  var privateChatBox = document.getElementById("privateChatBox");
  var privateMessageInput = document.getElementById("privateMessageInput");
  var sendPrivateMessageBtn = document.getElementById("sendPrivateMessageBtn");
  var backToMainFromPrivateBtn = document.getElementById("backToMainFromPrivateBtn");

  var userName = localStorage.getItem("chatAppName");

  // Show name input if not saved
  if (!userName) {
    nameContainer.style.display = "block";
  } else {
    loadMainInterface();
  }

  saveNameBtn.onclick = function () {
    userName = nameInput.value.trim();
    if (userName) {
      localStorage.setItem("chatAppName", userName);
      db.ref("users/" + userName).update({ online: true });
      loadMainInterface();
    }
  };

  function loadMainInterface() {
    nameContainer.style.display = "none";
    mainInterface.style.display = "block";
    displayRecentChats();
  }

  function displayRecentChats() {
    recentChatsContainer.innerHTML = "";
    db.ref("users/" + userName + "/recentChats").on("value", function (snapshot) {
      var chats = snapshot.val() || {};
      for (var chatUser in chats) {
        var chatButton = document.createElement("button");
        chatButton.textContent = chatUser;
        chatButton.onclick = function () {
          startPrivateChat(chatUser);
        };
        recentChatsContainer.appendChild(chatButton);
      }
    });
  }

  worldChatBtn.onclick = function () {
    mainInterface.style.display = "none";
    worldChatSection.style.display = "block";
    loadWorldChatMessages();
  };

  backToMainBtn.onclick = function () {
    worldChatSection.style.display = "none";
    mainInterface.style.display = "block";
  };

  function loadWorldChatMessages() {
    chatBox.innerHTML = "";
    db.ref("world-chat").limitToLast(15).on("value", function (snapshot) {
      snapshot.forEach(function (childSnapshot) {
        var message = childSnapshot.val();
        var messageDiv = document.createElement("div");
        messageDiv.textContent = message.sender + ": " + message.text;
        chatBox.appendChild(messageDiv);
      });
    });
  }

  sendWorldMessageBtn.onclick = function () {
    var message = messageInput.value.trim();
    if (message) {
      db.ref("world-chat").push({ sender: userName, text: message, timestamp: Date.now() });
      messageInput.value = "";
    }
  };

  function startPrivateChat(chatUser) {
    mainInterface.style.display = "none";
    privateChatSection.style.display = "block";
    chatWithTitle.textContent = "Chat with " + chatUser;

    loadPrivateChatMessages(chatUser);

    sendPrivateMessageBtn.onclick = function () {
      sendPrivateMessage(chatUser);
    };

    backToMainFromPrivateBtn.onclick = function () {
      privateChatSection.style.display = "none";
      mainInterface.style.display = "block";
    };
  }

  function loadPrivateChatMessages(chatUser) {
    privateChatBox.innerHTML = "";
    var chatRef = db.ref("private-chats/" + userName + "-" + chatUser).limitToLast(15);
    chatRef.on("value", function (snapshot) {
      snapshot.forEach(function (childSnapshot) {
        var message = childSnapshot.val();
        var messageDiv = document.createElement("div");
        messageDiv.textContent = message.sender + ": " + message.text;
        privateChatBox.appendChild(messageDiv);
      });
    });
  }

  function sendPrivateMessage(chatUser) {
    var message = privateMessageInput.value.trim();
    if (message) {
      var chatRef = db.ref("private-chats/" + userName + "-" + chatUser);
      chatRef.push({ sender: userName, text: message, timestamp: Date.now() });
      privateMessageInput.value = "";
    }
  }
})();

  
</script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="script.js"></script>
</body>
</html>
